<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.office.employee.mapper.NotificationMapper">

    <!-- 复杂条件查询通知 -->
    <select id="selectNotificationsWithConditions" resultType="com.office.employee.entity.Notification">
        SELECT * FROM notifications
        WHERE receiver_id = #{receiverId} AND is_deleted = 0
        <if test="notificationType != null and notificationType != ''">
            AND notification_type = #{notificationType}
        </if>
        <if test="priority != null and priority != ''">
            AND priority = #{priority}
        </if>
        <if test="isRead != null">
            AND is_read = #{isRead}
        </if>
        <if test="startDate != null">
            AND create_time &gt;= #{startDate}
        </if>
        <if test="endDate != null">
            AND create_time &lt;= #{endDate}
        </if>
        ORDER BY 
            is_read ASC,
            CASE priority 
                WHEN 'urgent' THEN 1 
                WHEN 'high' THEN 2 
                WHEN 'normal' THEN 3 
                WHEN 'low' THEN 4 
            END,
            create_time DESC
    </select>

</mapper>
